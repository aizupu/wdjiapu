<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
<link rel="stylesheet" type="text/css" href="/static/luru/css/style.css">

<link rel="stylesheet" type="text/css" href="/static/luru/css/bootstrap.min.css">

<script src="/static/luru/js/jquery.min.js"></script>
<script src="/static/luru/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/luru/js/bootbox.min.js"></script>
<meta name='viewport' content='width=device-width, initial-scale=1'>
        <title>族谱寻根平台</title>
        <!-- Styles -->
{# <link rel='stylesheet' type='text/css' href='{{ url_for('static/css/lib/calendar2',filename='pignose.calendar.min.css') }}'>#}

        <link href='/static/css/lib/calendar2/pignose.calendar.min.css' rel='stylesheet' type='text/css' />
        <link href='/static/css/lib/chartist/chartist.min.css' rel='stylesheet' type='text/css' />
        <link href='/static/css/lib/font-awesome.min.css' rel='stylesheet' type='text/css' />
        <link href='/static/css/lib/themify-icons.css' rel='stylesheet' type='text/css' />
        <link href='/static/css/lib/owl.carousel.min.css' rel='stylesheet' type='text/css' />
        <link href='/static/css/lib/owl.theme.default.min.css' rel='stylesheet' type='text/css' />
        <link href='/static/css/lib/weather-icons.css' rel='stylesheet' type='text/css' />
        <link href='/static/css/lib/menubar/sidebar.css' rel='stylesheet'type='text/css' />
        <link href='/static/css/lib/bootstrap.min.css' rel='stylesheet' type='text/css' />
        <link href='/static/css/lib/helper.css' rel='stylesheet' type='text/css' />
        <link href='/static/css/style.css' rel='stylesheet' type='text/css' />


    </head>

    <body>

          <div class='sidebar sidebar-hide-to-small sidebar-shrink sidebar-gestures'>
            <div class='nano'>
                <div class='nano-content'>
                    <ul>
                        <div class='logo'><a href='#'><!-- <img src='assets/images/logo.png' alt='' /> --><span>LOGO</span></a></div>
                 <li class='label'>族谱一览</li>
                        <li><a class='sidebar-sub-toggle'><i class='ti-home'></i>公开族谱<span class='sidebar-collapse-icon ti-angle-down'></span></a>
                            <ul>
                                <ul>
                                    <li><a href='/index'>族谱预览</a></li>
                                    <li><a href='#'>族谱可视化</a></li>

                                </ul>

                            </ul>
                        </li>

                        <li class='label'>族谱管理</li>
                        <li><a class='sidebar-sub-toggle'><i class='ti-bar-chart-alt'></i>我的族谱<span class='sidebar-collapse-icon ti-angle-down'></span></a>
                            <ul>
                                <ul>
                                    <li><a href='/genealogy'>族谱查看</a></li>
{#                                    <li><a href="{{ url_for('luru_person') }}">族谱修改</a></li>#}
									<li><a href='/keshihua'>族谱可视化</a></li>
                                    <li><a href='#'>其他</a></li>
                                </ul>

                            </ul>
                        </li>
                        <li><a class='sidebar-sub-toggle'><i class='ti-layout'></i>权限管理<span class='sidebar-collapse-icon ti-angle-down'></span></a>
                            <ul>
                                <ul>
                                    <li><a href='user_limit1'>权限申请</a></li>
                                    <li><a href='user_limit'>权限编辑</a></li>

                                </ul>

                            </ul>
                        </li>
                        <li><a href='profile'><i class='ti-user'></i> 个人信息</a>

                        </li>

                        <li class='label'>文档</li>
                        <li><a href='/file/upload'><i class='ti-view-list-alt'></i> 文档上传</a></li>
						<li><a href='/file/download'><i class='ti-view-list-alt'></i> 文档下载</a></li>
						<li><a href='#'><i class='ti-view-list-alt'></i> 文档修改</a></li>
                        <li class='label'>其他</li>
                        <li><a href='login_out'><i class='ti-close'></i>退出</a> </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- /# sidebar -->

            <div class='header'>
        <div class='container-fluid'>
            <div class='row'>
                <div class='col-lg-12'>
                    <div class='float-left'>
                        <div class='hamburger sidebar-toggle'>
                            <span class='line'></span>
                            <span class='line'></span>
                            <span class='line'></span>
                        </div>
                    </div>
                    <div class='float-right'>
                        <div class='dropdown dib'>
                            <div class='header-icon' data-toggle='dropdown'>
                                <i class='ti-bell'></i>
                                <div class='drop-down dropdown-menu dropdown-menu-right'>
                                    <!-- 提醒 -->
                                </div>
                            </div>
                        </div>
                        <div class='dropdown dib'>
                            <div class='header-icon' data-toggle='dropdown'>
                                <i class='ti-email'></i>
                                <div class='drop-down dropdown-menu dropdown-menu-right'>
                                    <!-- 消息 -->
                                </div>
                            </div>
                        </div>
                        <div class='dropdown dib'>
                            <div class='header-icon' data-toggle='dropdown'>
                                <a class='user-avatar'>
                                    用户
                                    <i class='ti-angle-down f-s-10'></i>
                                </a>
                                <div class='drop-down dropdown-profile dropdown-menu '>

                                    <div class=''>
                                        <ul>
                                            <li>
                                                <a href='profile' style="color: #0f0f10">
                                                    <i class='ti-user'></i>
                                                    个人信息
                                                </a>
                                            </li>

                                            <li>
                                                <a href='luru_genealogy' style="color: #0f0f10">
                                                    <i class='ti-email'></i>
                                                    家谱管理
                                                </a>
                                            </li>
                                            <li>
                                                <a href='user_limit1' style="color: #0f0f10">
                                                    <i class='ti-settings'></i>
                                                    申请
                                                </a>
                                            </li>
                                            <li>
                                                <a href='login_out' style="color: #0f0f10">
                                                    <i class='ti-power-off'></i>
                                                    退出
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

         <div class ="content-wrap">



   <style>
        .node circle {
            fill: #fff;
            stroke: steelblue;
            stroke-width: 1.5px;
        }

        .node {
            font: 12px sans-serif;
        }

        .link {
            fill: none;
            stroke: #ccc;
            stroke-width: 1.5px;
        }
    </style>


   <script src="/static/json/d3.js"></script>
{#   <script src="/static/json/Jsondata.json"></script>#}
              <script src="/static/json/test1.json"></script>
{#   <script src="/static/json/test0.json"></script>#}
{#    json转树形json         #}
{#<script type="text/javascript">#}
{#	//将json串转换成树形结构#}
{#	function transData(a, idStr, father_idStr, childrenStr) {#}
{#		var r = [], hash = {}, id = idStr, father_id = father_idStr, children = childrenStr, i = 0, j = 0, len = a.length;#}
{#		for (; i < len; i++) {#}
{#			hash[a[i][id]] = a[i];#}
{#		}#}
{#		for (; j < len; j++) {#}
{#			var aVal = a[j], hashVP = hash[aVal[father_id]];#}
{#			if (hashVP) {#}
{#				!hashVP[children] && (hashVP[children] = []);#}
{#				hashVP[children].push(aVal);#}
{#			} else {#}
{#				r.push(aVal);#}
{#			}#}
{#		}#}
{#		return r;#}
{#	}#}
{##}
{#	//测试方法#}
{##}
{#		//绑定的字段#}
{#		//绑定的字段#}
{#		var jsonDataTree = transData(Jsondata, 'id', 'father_id', 'children');#}
{#		var endJson='{"end":"1"}';#}
{#		var beginJson='{"begin":"1"}';#}
{#		jsonDataTree.push(JSON.parse(endJson));#}
{#		jsonDataTree.unshift(JSON.parse(beginJson));#}
{#		console.log(jsonDataTree);#}
{#		var jsonstr=(JSON.stringify(jsonDataTree).replace(/\[\{"begin":"1"\},|,\{"end":"1"\}\]/g, ''))#}
{#		var json=JSON.parse(jsonstr);#}
{#		// document.write(JSON.stringify(json))#}
{##}
{#</script>#}
{#<script>#}
{##}
{#        var options = {#}
{#            width: 1800,#}
{#            height: 920,#}
{#            boxWidth: 65,#}
{#            boxHeight: 40#}
{#        }#}
{##}
{#        // 纵向树状图类#}
{#        var StructureGraph = function () {#}
{#            // 布局#}
{#            this.tree = d3.layout.tree()#}
{#                .size([options.width, options.height - 200])#}
{#                .separation(function (a, b) {#}
{#                    return (a.parent == b.parent ? 1 : 2);#}
{#                });#}
{##}
{#            this.diagonal = d3.svg.diagonal()#}
{#                .projection(function (d) {#}
{#                    return [d.x, d.y];#}
{#                });#}
{##}
{#            // 用来拖拽图以及扩大缩放#}
{#            let zoom = d3.behavior.zoom()#}
{#                .scaleExtent([.1, 1])#}
{#                .on('zoom',  () => {#}
{#                    this.svg.attr("transform", "translate(" + d3.event.translate + ") scale(" + d3.event.scale + ")");#}
{#                });#}
{#            this.svg = d3.select("body").append("svg")#}
{#                .attr("width", options.width + 80)#}
{#                .attr("height", options.height)#}
{#                .call(zoom)#}
{#                .append("g")#}
{#                .attr("transform", "translate(40,40)");#}
{#        }#}
{##}
{#        // 开始渲染节点与连线#}
{#        StructureGraph.prototype.render = function (source) {#}
{#            this.renderLinks(source);#}
{#            this.renderNodes(source);#}
{#            return this;#}
{#        }#}
{##}
{#        // 渲染节点#}
{#        StructureGraph.prototype.renderNodes = function (source) {#}
{#            var _this = this;#}
{#            this.node = this.svg.selectAll(".node")#}
{#                .data(this.nodes)#}
{#                .enter()#}
{#                .append("g")#}
{#                .attr("class", "node")#}
{#                .attr("strokeWidth", 100)#}
{#                .attr("transform", function (d) {#}
{#                    return "translate(" + d.x + "," + d.y + ")";#}
{#                })#}
{#            // 绘制矩形与文字#}
{#            drawRect();#}
{##}
{#            function drawRect() {#}
{#                _this.node.append("rect")#}
{#                    .attr('y', 0)#}
{#                    .attr('x', function (d) {#}
{#                        return d.depth !== 2 ? -(options.boxWidth / 2) : -(options.boxHeight / 2)#}
{#                    })#}
{#                    .attr('width', function (d) {#}
{#                        return d.depth !== 2 ? options.boxWidth : options.boxHeight;#}
{#                    })#}
{#                    .attr('height', function (d) {#}
{#                        return d.depth !== 2 ? options.boxHeight : options.boxWidth;#}
{#                    })#}
{#                    // 矩形背景色以及边框颜色宽度#}
{#                    .attr('fill', '#fff')#}
{#                    .attr('stroke', 'steelblue')#}
{#                    .attr('strokeWidth', '1px')#}
{#                    .on('click', function (evt) {#}
{#                        console.log(evt); // 显示所点击节点数据#}
{#                    });#}
{##}
{#                // Draw the person's common_name and position it inside the box#}
{#                _this.node.append("text")#}
{#                    .attr('y', function (d) {#}
{#                        return d.depth !== 2 ? options.boxHeight / 2 + 5 : 0;#}
{#                    })#}
{#                    // .attr('rotate', function (d) { //显示竖直显示中文时rotate为0，英文-90#}
{#                    //     return 0;#}
{#                    // })#}
{#                    .attr('style', function (d) {#}
{#                        return d.depth !== 2 ? '' : "writing-mode: tb;letter-spacing:0px";#}
{#                    })#}
{#                    .attr("text-anchor", function (d) {#}
{#                        return d.depth !== 2 ? 'middle' : "start";#}
{#                    })#}
{#                    .text(function (d) {#}
{#                        return d.common_name;#}
{#                    });#}
{#            }#}
{##}
{#        }#}
{##}
{#        // 渲染连线#}
{#        StructureGraph.prototype.renderLinks = function (source) {#}
{#            var _this = this;#}
{#            this.nodes = this.tree.nodes(source);#}
{##}
{#            this.links = this.tree.links(this.nodes);#}
{##}
{#            drawLine();#}
{#            // 将曲线换为折线#}
{#            function drawLine() {#}
{#                var link = _this.svg.selectAll("path.link")#}
{##}
{#                    // The function we are passing provides d3 with an id#}
{#                    // so that it can track when data is being added and removed.#}
{#                    // This is not necessary if the tree will only be drawn once#}
{#                    // as in the basic example.#}
{#                    .data(_this.links);#}
{##}
{#                // Add new links#}
{#                link.enter().append("path")#}
{#                    .attr("class", "link");#}
{##}
{#                // Remove any links we don't need anymore#}
{#                // if part of the tree was collapsed#}
{#                link.exit().remove();#}
{##}
{#                // Update the links positions (old and new)#}
{#                link.attr("d", elbow);#}
{##}
{#                function elbow(d) {#}
{#                    let sourceX = d.source.x,#}
{#                        sourceY = d.source.y + options.boxHeight,#}
{#                        targetX = d.target.x,#}
{#                        targetY = d.target.y;#}
{##}
{#                    return "M" + sourceX + "," + sourceY +#}
{#                        "V" + ((targetY - sourceY) / 2 + sourceY) +#}
{#                        "H" + targetX +#}
{#                        "V" + targetY;#}
{##}
{#                }#}
{#            }#}
{#        }#}
{##}
{#        // 初始化实例。与jquery配合使用可以通过将下面两行代码放到$.fn.structure = (){}中，增加自定义插件#}
{#        var ins = new StructureGraph();#}
{#        ins.render(Jsondate);#}
{#    </script>#}
 <script>
        var options = {
            width: 1800,
            height: 920,
            boxWidth: 65,
            boxHeight: 40
        }
        var city_tree = {
            "name": "张三",
            "children": [

                {
                    "name": "张三",
                    "children": [{
                            "name": "李四",
                            "children": [{
                                    "name": "王二"
                                },
                                {
                                    "name": "王二"
                                }
                            ]
                        },
                        {
                            "name": "王二"
                        },
                        {
                            "name": "王二"
                        },
                        {
                            "name": "王二"
                        }
                    ]
                },

                {
                    "name": "王二",
                    "children": [{
                            "name": "王二"
                        },
                        {
                            "name": "王二"
                        }

                    ]
                },


            ]
        }

        // 纵向树状图类
        var StructureGraph = function () {
            // 布局
            this.tree = d3.layout.tree()
                .size([options.width, options.height - 200])
                .separation(function (a, b) {
                    return (a.parent == b.parent ? 1 : 2);
                });

            this.diagonal = d3.svg.diagonal()
                .projection(function (d) {
                    return [d.x, d.y];
                });

            // 用来拖拽图以及扩大缩放
            let zoom = d3.behavior.zoom()
                .scaleExtent([.1, 1])
                .on('zoom',  () => {
                    this.svg.attr("transform", "translate(" + d3.event.translate + ") scale(" + d3.event.scale + ")");
                });
            this.svg = d3.select("body").append("svg")
                .attr("width", options.width + 80)
                .attr("height", options.height)
                .call(zoom)
                .append("g")
                .attr("transform", "translate(40,40)");
        }

        // 开始渲染节点与连线
        StructureGraph.prototype.render = function (source) {
            this.renderLinks(source);
            this.renderNodes(source);
            return this;
        }

        // 渲染节点
        StructureGraph.prototype.renderNodes = function (source) {
            var _this = this;
            this.node = this.svg.selectAll(".node")
                .data(this.nodes)
                .enter()
                .append("g")
                .attr("class", "node")
                .attr("strokeWidth", 100)
                .attr("transform", function (d) {
                    return "translate(" + d.x + "," + d.y + ")";
                })
            // 绘制矩形与文字
            drawRect();

            function drawRect() {
                _this.node.append("rect")
                    .attr('y', 0)
                    .attr('x', function (d) {
                        return d.depth !== 2 ? -(options.boxWidth / 2) : -(options.boxHeight / 2)
                    })
                    .attr('width', function (d) {
                        return d.depth !== 2 ? options.boxWidth : options.boxHeight;
                    })
                    .attr('height', function (d) {
                        return d.depth !== 2 ? options.boxHeight : options.boxWidth;
                    })
                    // 矩形背景色以及边框颜色宽度
                    .attr('fill', '#fff')
                    .attr('stroke', 'steelblue')
                    .attr('strokeWidth', '1px')
                    .on('click', function (evt) {
                        console.log(evt); // 显示所点击节点数据
                    });

                // Draw the person's name and position it inside the box
                _this.node.append("text")
                    .attr('y', function (d) {
                        return d.depth !== 2 ? options.boxHeight / 2 + 5 : 0;
                    })
                    // .attr('rotate', function (d) { //显示竖直显示中文时rotate为0，英文-90
                    //     return 0;
                    // })
                    .attr('style', function (d) {
                        return d.depth !== 2 ? '' : "writing-mode: tb;letter-spacing:0px";
                    })
                    .attr("text-anchor", function (d) {
                        return d.depth !== 2 ? 'middle' : "start";
                    })
                    .text(function (d) {
                        return d.name;
                    });
            }

        }

        // 渲染连线
        StructureGraph.prototype.renderLinks = function (source) {
            var _this = this;
            this.nodes = this.tree.nodes(source);

            this.links = this.tree.links(this.nodes);

            drawLine();
            // 将曲线换为折线
            function drawLine() {
                var link = _this.svg.selectAll("path.link")

                    // The function we are passing provides d3 with an id
                    // so that it can track when data is being added and removed.
                    // This is not necessary if the tree will only be drawn once
                    // as in the basic example.
                    .data(_this.links);

                // Add new links
                link.enter().append("path")
                    .attr("class", "link");

                // Remove any links we don't need anymore
                // if part of the tree was collapsed
                link.exit().remove();

                // Update the links positions (old and new)
                link.attr("d", elbow);

                function elbow(d) {
                    let sourceX = d.source.x,
                        sourceY = d.source.y + options.boxHeight,
                        targetX = d.target.x,
                        targetY = d.target.y;

                    return "M" + sourceX + "," + sourceY +
                        "V" + ((targetY - sourceY) / 2 + sourceY) +
                        "H" + targetX +
                        "V" + targetY;

                }
            }
        }

        // 初始化实例。与jquery配合使用可以通过将下面两行代码放到$.fn.structure = (){}中，增加自定义插件
        var ins = new StructureGraph();
        ins.render(city_tree);
    </script>
</div>
<script type='text/javascript' src='/static/js/lib/jquery.min.js'></script>
        <script type='text/javascript' src='/static/js/lib/jquery.nanoscroller.min.js'></script>
        <!-- nano scroller -->
        <script type='text/javascript' src='/static/js/lib/menubar/sidebar.js'></script>
        <script type='text/javascript' src='/static/js/lib/preloader/pace.min.js'></script>
        <!-- sidebar -->

        <script type='text/javascript' src='/static/js/lib/bootstrap.min.js'></script>
        <script type='text/javascript' src='/static/js/scripts.js'></script>
        <!-- bootstrap -->

        <script type='text/javascript' src='/static/js/lib/calendar-2/moment.latest.min.js'></script>
        <script type='text/javascript' src='/static/js/lib/calendar-2/pignose.calendar.min.js'></script>
        <script type='text/javascript' src='/static/js/lib/calendar-2/pignose.init.js'></script>


        <script type='text/javascript' src='/static/js/lib/weather/jquery.simpleWeather.min.js'></script>
        <script type='text/javascript' src='/static/js/lib/weather/weather-init.js'></script>
        <script type='text/javascript' src='/static/js/lib/circle-progress/circle-progress.min.js'></script>
        <script type='text/javascript' src='/static/js/lib/circle-progress/circle-progress-init.js'></script>
        <script type='text/javascript' src='/static/js/lib/chartist/chartist.min.js'></script>
        <script type='text/javascript' src='/static/js/lib/sparklinechart/jquery.sparkline.min.js'></script>
        <script type='text/javascript' src='/static/js/lib/sparklinechart/sparkline.init.js'></script>
        <script type='text/javascript' src='/static/js/lib/owl-carousel/owl.carousel.min.js'></script>
        <script type='text/javascript' src='/static/js/lib/owl-carousel/owl.carousel-init.js'></script>

    </body>
</html>